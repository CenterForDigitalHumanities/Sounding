<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <meta charset="utf-8">
<!--        <link rel="stylesheet" href="../brokenBooks/css/brokenbooks.css">	
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>  
        <script src="../brokenBooks/js/bb.js"></script>  
        <title>Sort Breviary Order</title>-->
        <style>
            .leafPopover{
                position: absolute;
                display: none;
                left: 0;
                right: 0;
                margin: 0 auto;
                top: 25px;
            }
            .mainBlock{
                background-color:white;
            }
            .mainBlock.imgAdditionArea{
                background-color:black !important;
            }
            p{
                color: black;
            }
            .rangeArrangementArea{ /* Force each area to be the same height in this case. */
                height: 512px;
                z-index: 2;
            }
            .arrangeSection{
                z-index: 2;
            }
            .arrangeSection div{
                z-index: 1;
            }
            div[leaf="true"]{
                display: block;
                border: 2px solid black;
            }
            .child .child{
                display: none;
            }
            .parent .child{
                display: none;
            }
            .unassigned .child{ /* This will hide leaves sitting in the unassigned areas. */
                display: none !important;
            }
            .unassigned .parent{ /* This will hide leaves sitting in the unassigned areas. */
                display: none !important;
            }
            .arrangeSection, .unassigned{
                padding: 8px 50px 8px 21px !important;
            }
            .notBucket{
                padding: 4px 4px 45px 4px;
                border: 1px solid red;
                margin-bottom: 5px;
            }
            div[relation="bucket"] {
                display: inline-block;
                border-right: 2px solid black;
                border-left: transparent;
                border-top: transparent;
                border-bottom: transparent;
            }  
            #mainBlockHelp{
                display: none;
                position: fixed;
                margin: 0 auto;
                
            }
            #mainBlockHelp h4{
                margin: 5px 10px !important;
                text-align: left !important;
                color: #6D6E7B;
                font-family: sans-serif;
                font-size: 14px;
                font-weight: bold;
            }
            #mainBlockHelp p{
                padding: 0px !important;
                text-align: left !important;
                margin: 0px 10px !important;
                color: #6D6E7B;
                font-family: sans-serif;
                font-size: 14px;
            }
            #mainBlockHelp .demoContent{
                padding: 5px 0px;
                
            }
            /*.rectoImg, .versoImg{
                background-image : url("http://localhost:8080/brokenBooks/images/imgNotFound.png") !important;
            } */        
        </style>
    </head>
    <body>
        <div class="mainBlock">
            <div class="mainBlockCover"></div>
            <div class="arrangeTrail adminTrail">
                <div class="rangeArrangementArea" depth = "1" rangeID="bucket">
                   <div class="rAreaLabel">Llangantock Subsections</div>
                   
                   <div ondragover='dragOverHelp(event);' ondrop='dropHelp(event);' class="notBucket"></div>
                   <div ondragover='dragOverHelp(event);' ondrop='dropHelp(event);' rangeID="bucket" onclick='toggleChildren($(this), "admin", event);'  class="arrangeSection parent unassigned sortOrder"><span>Bucket</span></div>
                   <input class="makeGroup" value="Group" type="button" onclick="askForNewTitle($(this).parent());"/>
                   <input class="addGroup" value="Add" type="button" onclick="newGroupForm($(this).parent());"/>
                   <input class="makeSortable" value="Sort" type="button" onclick="makeSortable($(this).parent());"/><input class="doneSortable" value="Done" type="button" onclick="stopSorting($(this).parent());"/><br>
                   <input class="resetCounts" value="Reset Folio Count" type="button" onclick="resetFolioCount();"/>
                </div>
            </div>
        </div>
        <div id="mainBlockHelp" class="demoPopover"> 
                <div class="leafPopClose" onclick="$('#mainBlockHelp').hide(); $(this).parent().parent().find('.mainBlockCover').hide();">X</div>
                <div class="popHdr">Help</div>
                <div class='demoContent'>
                    <p>
                        You cannot add leaves in this interface.
                    </p>
                    <p>
                        You can add a new section/group and place existing leaves within them.
                    </p>
                    <h4>Drag and Drop</h4>
                    <p>
                        When you drag and drop, you are specifically moving one grouping to another.
                        The original positioning will be removed. You can drop into any group and into any
                        column's red area.  When you move a grouping, you also move all of its children with it.
                    </p>
                    <h4>Create New Group</h4>     
                    <p>
                        You can create a new group in any column. You will be given a list of leaves to add
                        to the area and a field to enter a label. You can make an empty group.
                        You can also group any existing groups or leaves together. Check their checkboxes
                        and click 'Group' to group the select areas together. Leaves grouped in the
                        unassigned areas will be removed from unassigned and ordered within the red
                        area.
                    </p>
                    <h4>Remove Group</h4>
                    <p>
                        If you want to remove a group, you can "break" it. Removing a group would mean
                        you also want to remove all of its children. Breaking a group removes the parent
                        and brings up all the children. If you break a leaf or an empty group, you delete it.
                        Right click on an area to be given the option to break it.
                    </p>
                    <h4>Order a Group</h4>
                    <p>
                        If you would like to order a group, click to expand its children to a column and click
                        the Sort button. You will not be able to do any dragging or area creation while you
                        are ordering a group. Either cancel or save to resume blocked functionality.
                    </p>
                    <h4>Bucket/Unassigned</h4>
                    <p>
                        Each column has an 'unassigned' area. This area is for leaves that have not been
                        specifically ordered by another group or from being given a position. The leaves in
                        the unassigned area of a group are in no specific order but specifically tied to that group.
                        The unassigned area cannot be ordered. Make a group out of the leaves in these areas or drag them out and drop
                        them where you want them to go.
                    </p>
                    <p>
                        Each listed area can be clicked to reveal its children and unassigned area or to
                        close it.
                    </p>
                    <h4>Leaf Locking</h4>
                    <p>
                        Each leaf has a lock icon with pointing up and down.  You can lock a leaf to its sibling by clicking
                        this lock icon.  The icon will appear locked if the leaf has already been locked.  When you lock a leaf,
                        all position reassigning done to one leaf will automatically happen to the other.  This represents leaves you
                        know are consecutive with each other, so if you want to move one to another section, you have to take all the 
                        consecutive locked siblings as well.
                    </p>
                    <h4>Miscellaneous</h4>
                    <p>
                        The number of leaves in an area are shown in a page icon on the right of each
                        group bar. If you have made changes, the leaf count may not be accurate. You can
                        click 'Reset Folio Count' to get an accurate leaf count for each section. It will save
                        all changes and close everything to do this.
                    </p>
                    <p>    
                        Each leaf has a blue 'i' icon.  Click this to open the leaf creation interface with that leaves information
                        already populated.  The leaf metadata can be altered.  
                    </p>
                    <p>Double click on a section or leaf to be able to change its title.</p>
                    <input type="button" onclick="$('#mainBlockHelp').hide(); $(this).parent().parent().find('.mainBlockCover').hide();" value="Close" />
                </div>
            </div>
        <div id="newGroupForm">
            <p>Enter a label for the new group, then select the leaves that belong.  They will initially be unordered, you will need to order them.</p>
            Label: <input type="text" id="groupTitle" />
            <div id="allLeaves">

            </div>
            <div class="noTitleWarning">You must supply a label to create a new group!</div>
            <input id="saveGroupForm" type="button" onclick="saveNewGroupForm();" value="Save"/>
            <input type="button" onclick="cancelNewGroupForm();" value="Cancel"/>
        </div>
        <div class="leafPopover"></div>
        
    </body>
    <script>

    function makeSortable(column){
        //Will sortable overrule draggable? 
        var columnDepth = column.attr("depth");
        column.children('.notBucket').sortable({helper:'clone'});
        $.each($(".adminTrail").find(".rangeArrangementArea").not(".rangeArrangementArea[depth='"+columnDepth+"']"), function(){
            var overDiv = $("<div class='areaCover'></div>");
            console.log("Append over div to");
            console.log($(this));
            $(this).append(overDiv);
        });
        column.children(".makeSortable").hide();
        column.children(".doneSortable").show();
    }
    function stopSorting(column){
        column.children(".notBucket").sortable("destroy");
        $(".areaCover").remove();
        column.children(".makeSortable").show();
        column.children(".doneSortable").hide();
    }
    function resetFolioCount(){
        if($(".rangeArrangementArea:first").find(".selectedSection").length > 0){
            $(".rangeArrangementArea:first").find(".selectedSection").click();
        }
        $.each($(".arrangeSection"), function(){
            $(this).children(".folioCount").remove();
            var folioCount = $(this).find("div[leaf='true']").length;
            var folioCountHTML = $("<span class='folioCount'>"+folioCount+"</span>");
            if($(this).attr("leaf") === "true"){
                folioCountHTML = $("<span class='folioCount'><img class='leafIcon' src='http://localhost:8080/brokenBooks/images/leaf.png'/></span>");
            }      
         $(this).append(folioCountHTML);
       });
    }

        $(function(){
            //NOTE: THIS SHOULD ONLY WORK FOR ADMINS
            
            gatherRangesForArrange(2); //populate the admin interface
        });

    </script>
</html>
