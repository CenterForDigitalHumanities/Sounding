<!DOCTYPE html>
<!--
author: Patrick Cuba <cubap@slu.edu>
based on Broken Books (git root) by <bhaberbe@slu.edu>
-->
<html>
    <head>
        <title>Deep Codex</title>
        <meta charset="UTF-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script src="js/bb.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css">
    </head>
    <body>
        <header class="hero">
            <div class="hero-body">
                <div class="container">
                    <a href="home.html">
                        <img id="logo" src="images/logo.png" alt="logo"/>
                </a>
                </div>
            </div>
        </header>
        <section class="section">
            <h1 class="title">
                    Welcome to Deep Codex
                </h1>
            <div class="columns">
                <div class="column is-5">
                    <img class="image" src="images/upperimage.jpg"/>
            </div>
            <div class="column content">
                <p>
                    A book, though it may feel like permanent and stable format, may be as difficult to ensnare
                    as the ideas and art it contains. Through history, books are rebound in different orders and
                    gatherings, destroyed in whole or in part, cut apart for sale as collectibles, or otherwise
                    decomposed from the codex it was originally presented as. In other cases, documents existed
                    for a long time before being gathered into a codex which comprises the canonical version. A
                    need to reorder, assemble, and describe individual pieces of a book with precision arises.
                </p>
                <p>
                    This site expands the capabilities of the <a href="http://brokenbooks.org">Broken Books project</a>,
                    which constructs the famously broken, pre-modern manuscript known as the <cite>Llangattock Breviary</cite>.
                    The focused effort quickly hatched new projects and highlighted the need for a version of
                    the tools used in Broken Books that risked breaking the careful schema and control needed for
                    the seminal Llangatock project.
                </p>
                <p>
                    The power behind the digital reconstruction is
                    <a target="_blank" href="http://iiif.io/model/shared-canvas/1.0/index.html">SharedCanvas</a> technology
                    and the <a target="_blank" href="http://iiif.io">International Image Interoperability Framework</a> (IIIF).
                    Using these standards we can create surrogates that anchor the digital images and descriptive annotations
                    of the relevant leaves. The original goal, of reconstructing a dismembered manuscript remains,
                    but Deep Codex hopes to expand that possibilities to allow virtual manuscript creation and the
                    generation of multiple sequences for the same manuscript. Even for intact codices, the possibility
                    of complex structures for navigation, flexible annotation and metadata, and open community contributions
                    represents a real advance for the IIIF standard.
                </p>
            </div>
            </div>
        </section>

        <section class="section">
            <h1 class="title">
                About Broken Books
            </h1>
            <div class="columns">
                <div class="content">
                    <p>
                        One important component of Deep Codex is the ability for anyone to contribute at any level they want.
                        The interface offers infinite fields for metadata, image linking, and the ability to place the leaf
                        within a structure for logical construction. Users can fill out as much or as little information
                        about the leaf as they wish.
                    </p>

                    <p>
                        Project owners are given the ability to construct and set up the organizational structure of the book or
                        manuscript they want to rebuild.  This structure then receives uploaded leaves that can be placed within it. Leaves
                        that are contributed are reviewed and once approved can be placed within the publicized structure, which continually
                        redefines where leaves are still missing.
                    </p>

                    <p>
                        The publicized structure with its recovered leaves can be viewed online by any user who would like to read or study it.
                        Deep Codex uses the <a href="https://projectmirador.org">Mirador viewer</a> for these purposes.
                    </p>
                </div>
                <img class="image is-4" src="images/lowerimage.png"/>
            </div>
        </div>
        <div style="clear:both"></div>

        <div id="orderWrap">
            <div class="leafPopClose" onclick="$('#orderWrap').hide();"></div>
            <div class="popHdr"><span>Llangattock Arrangement</span>
            </div>
            <div id="orderMini" class="demoPopover">
                <div class="leafPopClose" onclick="$('#orderMini').hide(); $(this).parent().next().find('.mainBlockCover').hide();"></div>
                <div class="popHdr">arrange the leaves</div>
                <div class="demoContent demoHdrTxt">
                    Here you can arrange and sequence the leaves and groups of leaves. Once
                    you are finished and the information is submitted it will be reviewed for accuracy.
                    If your data is accurate, your leaf will be placed with the other Llangattock
                    Breviary leaves.
                    <input type="button" onclick="$('#orderMini').hide(); $(this).parent().parent().next().find('.mainBlockCover').hide();" value="Arrange" />
                </div>

            </div>
            <div id="ordering">

            </div>
        </div>

        <div class="leafPopover"></div>

        <div id="demoStarter" class="demoPopover">
            <div class="leafPopClose" onclick="demoPopoverClose();"></div>
            <div class="popHdr">Demo</div>
            <div class="demoContent">
                <div class="demoHdrTxt">
                    In this demo you will be able to interact with the leaf creation interface
                    and view a sample leaf in the Mirador viewer. In doing this you will act as a
                    contributor to the project. You will also be able to arrange a pre-created piece of
                    the breviary.  In doing this, you will act as a project creator and have the creator tools
                    available to you.
                </div>
                <div class="demobtn">
                    <input type="button" onclick="contribute();" value="Contribute" />
                    <div class="demoBtnHelper">Combine data or materials to create a leaf</div>
                </div>
                <div class="demobtn">
                    <input type="button" onclick="$('#orderWrap').show();" value="Arrange" />
                    <div class="demoBtnHelper">Create structure and arrange the leaves</div>
                </div>
                <div class="demobtn">
                    <input type="button" target="_blank" value="View" onclick="window.open('getManifest.html');" />
                    <div class="demoBtnHelper">View the current state of the reassembled Llangattock Breviary</div>
                </div>
            </div>
        </div>
        <div class="pageShade">

        </div>
    </body>
</html>
<script>
    var pageurl = document.location.href;
    if(pageurl.indexOf("demo=1") === -1){
        document.location.href = "/home.html?demo=1";
    }
 function contribute(){
     $(".leafPopover").show();
     $("#placement").children("input[type='button']").show();
    $(".popoverTrail").find(".arrangeAreaCover").remove();
    $("#placement").children("p:first").html("Here you can select the section of the breviary where you think the leaf belongs.");
    $(".popoverTrail").find(".selectedSection:first").click();
    submitIntro();
 }

 function demoPopover(){
//     if(navigator.userAgent.toLowerCase().indexOf("firefox") > -1){
//
//    }
//    else{
//        alert("The demo is unavailable in your browser at this time.  Please use Mozilla Firefox.");
//    }
        $("#demoStarter").show();
        $(".mainBlockCover").show();
        $("#createMini").show();
        $("#orderMini").show();
        $(".pageShade").show();
        $("#mainBlockHelp").hide();
 }
 function demoPopoverClose(){
     $('#demoStarter').hide();
     $('.pageShade').hide();
 }
 $(function(){
     var windowHeight = $(window).height();
     $("body").css("min-height", windowHeight+"px");
     $("#ordering").load("demoArrange.html", function(){

     });
     $(".leafPopover").load("leafPopover.html", function(){
                $(".leaf").load("leafInformation.html", function(){
                        console.log("SET TABS");
                        $("#formTabs").tabs({
                            activate: function(event ,ui){
                            //console.log(event);
                            if(ui.newTab.index() === 4){ //check for the selection of the arrante tab to change the side bar
                                $(".sideBarInfo").hide();
                                $("#sideBarArrange").show();
                            }
                            else{
                                $(".sideBarInfo").show();
                                $("#sideBarArrange").hide();
                            }
                        }
                        });
                        $('.canvasImageFile').on("change", function(event){
                            var target = event.target;
                            var rv = $(this).attr("rv"); //This is so we know whether it was the recto or verso one.
                            var files = !!this.files ? this.files : [];
                            var canvasURI = $(this).parent().parent().attr("canvas"); //local
                            if (!files.length || !window.FileReader) return 0; // no file selected, or no FileReader support

                            if (/^image/.test( files[0].type)){ // only image file
                                    var filename = files[0].name; //get the file name so we can pass it through the interfact for the user if we want.
                                var reader = new FileReader(); // instance of the FileReader
                                reader.readAsDataURL(files[0]); // read the local file
                                reader.onloadend = function(){ // set image data as background of div
                                        if(this.result.indexOf(".jpg")===-1 && this.result.indexOf(".JPG")===-1){
                                            alert("Our viewer only supports direct links to .jpg or .JPG file formats. If the image URL being submitted does not\n\
                                            contain the .jpg file format, it is unsupported.  If your link resolves to a hosted .jpg image, resolve the link and get\n\
                                            the URL that contains the .jpg format and submit that instead.");
                                        }
                                        else{
                                            $("."+rv+"Img").attr("src", this.result).show("explode", "500ms");
                                            $("."+rv+"Img").css("background-image", "none");
                                            $("."+rv+"Canvas").find(".imgCatalogueInfo").show("explode", "500ms");
                                            //$("textarea[rv='"+rv+"']").html(filename +" Uploaded!").attr("disabled", "disabled");
                                             var annotationObject = {
                                                "format":"image/jpg",
                                                "@type":"dctypes:Image",
                                                "resource":
                                                {
                                                    "@id": this.result,
                                                    "service":
                                                        {
                                                            "@context": "http://iiif.io/api/image/2/context.json",
                                                            "profile":"http://iiif.io/api/image/2/profiles/level2.json",
                                                            "@id" : this.result
                                                        },
                                                    "width": 667, //how should I set these?
                                                    "height":1000 //how should I set these?
                                                },
                                                "on" : canvasURI
                                            };
                                                            //$("#catalogueInfoFor").val(canvasURI);
                                            //(annotationObject, canvasURI); // local
                                            addImage(annotationObject, canvasURI); // live\
                                            target.parentNode.childNodes[1].onclick=""; //Take the onclick away that fires upload image.
                                            target.parentNode.ondblclick=function(){ //Now it has to be double clicked to fire upload image.
                                                target.click();
                                            };
                                        }
                                    };
                            }
                        });
//                        gatherRangesForArrange(1); //populate the popover
//                        $("#folioSide1").attr("onclick","enterCatalogueInfo('http://www.example.org/iiif/LlangBrev/canvases/demo1', 'recto');"); //local
//                        $("#folioSide1").attr("canvas","http://www.example.org/iiif/LlangBrev/canvases/demo1"); //local
//                        $("#folioSide2").attr("onclick","enterCatalogueInfo('http://www.example.org/iiif/LlangBrev/canvases/demo2', 'verso');"); //local
//                        $("#folioSide2").attr("canvas","http://www.example.org/iiif/LlangBrev/canvases/demo2"); //local
//                        $("#folioSie1").click();
                    });
            });

 });
</script>
