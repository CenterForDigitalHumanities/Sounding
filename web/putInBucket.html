<!DOCTYPE html>
<html>
	<head>
            <meta charset="utf-8">
            <link rel="stylesheet" href="../brokenBooks/css/brokenbooks.css">	
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>  
            <script src="http://localhost:8080/brokenBooks/js/bb.js"></script>  
            
            <title>Breviary Leaf Addition</title>
	</head>
	<body>
		<div class="mainBlock intro">
			<p>
				Here you can create a leaf.  Once you are finished and the information is submitted it will be reviewed for accuracy.  If your data is accurate, your leaf will be placed with the other LLangantock Breviary leaves. 
			</p>
			<p>You will prepare this leaf as <span id="whoCreates">a contriubter</span></p>

			<!-- TESTED. SUCCESSFUL.  
			<div id="serverLogin">
				<iframe id="serverLoginFrame" src="http://localhost/image_console.php" WIDTH=650 HEIGHT=400 >
						TEST TEST TEST
				</iframe>
			</div> -->
			
			<input type="button" id="beginLeafCreation" value="Begin Preparing A Leaf" onclick="submitIntro();"/>
			<input type="button" id="editLeaf" value="View Existing Leaf" onclick="existing();"/>
 			<input id="beAdmin" type="button" value="Be Project Admin" onclick="admin();"/>
			<input id="beContributer" type="button" value="Be A Contributer" onclick="contributer();"/>
		</div>
		<div class="mainBlock imgAdditionArea">
			<div id="leafAdditionLabel">
				Llangantock Leaf Addition
			</div>
            <div class="sideBarInfo">
                <div id="whatPiece">
                    <div id="oneAndtwo">
                    	<div style="margin-bottom: 17px;" id="oneAndtwoLabel">LEAF LABEL</div><img style="z-index:2; left: 10px; top:10px;" class="rectoImg" src=""/><img style="right: 60px; top: -10px; z-index: 1;" class="versoImg" src=""/>
                   	 	<img class="unselectedI" style="left: 34px; top:-11px;" src='http://www.iconexperience.com/_img/i_collection_png/512x512/plain/eye.png' onclick="showFullImage('oneAndtwo');"/>
                        <img class="selectedI" style="right: 109px; top: 22px;" src='https://cdn3.iconfinder.com/data/icons/pyconic-icons-1-2/512/eye-512.png' onclick="showFullImage('oneAndtwo');"/>
                	</div>
                    <div id="folioSide1"><input type="file" rv="recto" class="canvasImageFile" required="true" multiple="false" />
                    	<div id="folio1Label">Folio 1 Label</div>
                    	<img onclick="$(this).parent().find('input[type=\'file\']').click();" class="rectoImg" src=""/>
                        <img class="unselectedI" src='http://www.iconexperience.com/_img/i_collection_png/512x512/plain/eye.png' onclick="showFullImage('folioSide1');"/>
                    	<img class="selectedI" src='https://cdn3.iconfinder.com/data/icons/pyconic-icons-1-2/512/eye-512.png' onclick="showFullImage('folioSide1');"/>
                	</div>
                    <div id="folioSide2"><input type="file" rv="verso" class="canvasImageFile" required="true" multiple="false" />
                    	<div id="folio1Label">Folio 2 Label</div>
                    	<img onclick="$(this).parent().find('input[type=\'file\']').click();" class="versoImg" src=""/>
						<img class="unselectedI" src='http://www.iconexperience.com/_img/i_collection_png/512x512/plain/eye.png' onclick="showFullImage('folioSide2');"/>
                        <img class="selectedI" src='https://cdn3.iconfinder.com/data/icons/pyconic-icons-1-2/512/eye-512.png' onclick="showFullImage('folioSide2');"/>

                    </div>
                </div>
            </div>
            <div id="sideBarArrange">
                Leaf Label:&nbsp;&nbsp; <input type="text" id="leafLabel"/><br>
                <div id='leafTmp'>
                    <img style="left: 74px; top:0px;" class="rectoImg" src=""/>
                    <img style="right: 69px; top: 33px;" class="versoImg" src=""/>
                </div>
                <div id="arrangeCrumb">
                    <div>This leaf belongs to: </div>
                </div>
            </div>
            <div class="leaf"></div>
            <div style="clear:both"></div>
            <div id="fullImgContainer"><div onclick='$("#fullImgContainer").hide(); $("#fullImageShade").hide();' class='closeBtn'>X</div><img src=""/></div>
            <div id="fullImageShade"></div>
        </div>				
	</body>
</html>
<script>

//Here we have the "binder" to add our pieces into.  Notice that right now I have defined an anchor object and the master sequence range.
var rangeID = 1;
var canvasID = 1;
var annoID = 1;
var imageID = 1;
var annoListID = 5;
var currentLeaf = "";
var alpha, beta, zeta = false;
var annoListCollection = [];
var serverCanvasID = -1;
var serverAnnoID = -1;
var currentLeafServerID = -1;
var admin = false;
var contributer = true;


function existing(){
    var alphaCanvas = "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545";
    var betaCanvas = "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a547";
    var leaf = "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a549";

    var testLists = [
        {
            "@type" : "sc:AnnotationList",
            "on" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545",
            "originalAnnoID" : "",
            "version" : 1,
            "permission" : 0,
            "forkFromID" : "",
            "@id" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a546",
            "resources" : "[{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce6dee4b0f1c678d2a54c\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"General Metadata\",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"qwertyuuiio\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545\"},{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce6dee4b0f1c678d2a54b\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"Institution or Repository: \",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"qqqq\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545\"},{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce6dee4b0f1c678d2a54d\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"Date: \",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"wwww\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545\"},{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce6dee4b0f1c678d2a54e\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"Language:  \",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"eeee\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a545\"}]"
        },
        {
            "@type" : "sc:AnnotationList",
            "on" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a547",
            "originalAnnoID" : "",
            "version" : 1,
            "permission" : 0,
            "forkFromID" : "",
            "@id" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a548",
            "resources" : "[{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce6f3e4b0f1c678d2a550\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"Place Of Origin: \",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"ssss\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a547\"}]"
        },
        {
            "@type" : "sc:AnnotationList",
            "on" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a549",
            "originalAnnoID" : "",
            "version" : 1,
            "permission" : 0,
            "forkFromID" : "",
            "@id" : "http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a54a",
            "resources" : "[{\"@id\":\"http://165.134.241.141/annotationstore/annotation/554ce707e4b0f1c678d2a554\",\"@type\":\"oa:Annotation\",\"motivation\":\"sc:painting\",\"label\":\"Format (single leaf, half bifolium, fragment): \",\"resource\":{\"@type\":\"cnt:ContentAsText\",\"cnt:chars\":\"xxxxx\"},\"on\":\"http://165.134.241.141/annotationstore/annotation/554ce6d0e4b0f1c678d2a549\"}]"
        }
        

    ];
    //already included, full object, in the resources field.
       
    
    $("#folioSide1").attr("onclick","enterCatalogueInfo('"+alphaCanvas+"', 'recto');"); 
    $("#folioSide1").attr("canvas", alphaCanvas);
    $("#folioSide1").addClass("selectedFolio");

    $("#folioSide2").attr("onclick","enterCatalogueInfo('"+betaCanvas+"', 'verso');"); 
    $("#folioSide2").attr("canvas", betaCanvas);
    
    $("#oneAndtwo").attr("canvas", leaf);
    $("#oneAndtwo").attr("onclick","enterCatalogueInfo('leaf');"); 
    currentLeafServerID = leaf;
    submitIntro('testEdit');
    alpha = true;
    annoListCollection[0] = testLists[0];
    annoListCollection[1] = testLists[1];
    annoListCollection[2] = testLists[2];
    $("#folioSide1").click();
}

//Below is a typical starter object from a project manager creating the manifest and the ancho leaf in that manifest.  This anchor leaf only had one canvas, which I assume we are allowing as a worse case scenario so I am accounting for it that way.  
var alphaAnnoList = {
	"@id":"http://www.example.org/iiif/LlangBrev/annoList/1", 
	"@type":"sc:AnnotationList",
	"resources" : [],
	"on" : ""
};
var betaAnnoList = {
	"@id":"http://www.example.org/iiif/LlangBrev/annoList/2", 
	"@type":"sc:AnnotationList",
	"resources" : [],
	"on" : ""
};
var zetaAnnoList = {
	"@id":"http://www.example.org/iiif/LlangBrev/annoList/3", 
	"@type":"sc:AnnotationList",
	"resources" : [],
	"on" : ""
};
var anchorAnnoList = {
	"@id":"http://www.example.org/iiif/LlangBrev/annoList/4", 
	"@type":"sc:AnnotationList",
	"resources" : [],
	"on" : "http://www.example.org/iiif/LlangBrev/canvas/1_anchor"
};
annoListCollection.push(alphaAnnoList, betaAnnoList, zetaAnnoList);


	$(function(){
		//$(".leaf").load("../brokenBooks/leafTemplate.html"); //This will not exist anymore. 
		$(".leaf").load("../brokenBooks/leafInformation.html", function(){
                    console.log("SET TABS");
                    $("#formTabs").tabs({
                        activate: function(event ,ui){
                        //console.log(event);
                        if(ui.newTab.index() === 4){ //check for the selection of the arrante tab to change the side bar
                            $(".sideBarInfo").hide();
                            $("#sideBarArrange").show();
                        }
                        else{
                            $(".sideBarInfo").show();
                            $("#sideBarArrange").hide();
                        }
                    }
                    });
                });
                $('.canvasImageFile').on("change", function(event){
                    //start spinny?
                    var target = event.target;
                    var rv = $(this).attr("rv"); //This is so we know whether it was the recto or verso one.  
                    var files = !!this.files ? this.files : [];
                    var canvasURI = $(this).parent().attr("canvas"); //local
                    var canvasServerURI = $(this).parent().parent().find(".imgCatalogueInfo").attr("canvasServerID"); //live
                    if (!files.length || !window.FileReader) return 0; // no file selected, or no FileReader support

                    if (/^image/.test( files[0].type)){ // only image file
                            var filename = files[0].name; //get the file name so we can pass it through the interfact for the user if we want.
                        var reader = new FileReader(); // instance of the FileReader
                        reader.readAsDataURL(files[0]); // read the local file
                        reader.onloadend = function(){ // set image data as background of div
                            $("."+rv+"Img").attr("src", this.result).show("explode", "500ms");
                            $("."+rv+"Canvas").find(".imgCatalogueInfo").show("explode", "500ms");
                            $("textarea[rv='"+rv+"']").html(filename +" Uploaded!").attr("disabled", "disabled");
                            var newAnnoURI = "http://www.example.org/iiif/LlangBrev/annos/" +annoID; 
                            var newImageURI = "http://www.example.org/iiif/LlangBrev/images/" +imageID; 
                            var annotationObject = {
                                                    "@id" : newAnnoURI,
                                            "@type" : "oa:Annotation",
                                            "motivation" : "sc:painting",
                                            "label" : "Canvas Image",
                                            "resource" : {
                                                    "@id" : newImageURI,
                                                    "@type" : "dctypes:Image",
                                                    "format" : "image/jpeg",
                                                    "height" : 2365,
                                                    "width" : 1579
                                                    },
                                                    "on" : canvasServerURI
                                            };
                                            //$("#catalogueInfoFor").val(canvasURI);
                            //(annotationObject, canvasURI); // local
                            addImage(annotationObject, canvasServerURI); // live\
                            target.parentNode.childNodes[1].onclick=""; //Take the onclick away that fires upload image.
                            target.parentNode.ondblclick=function(){ //Now it has to be double clicked to fire upload image. 
                                target.click();
                            };
                            
                        };

                    }
                });
	});
		
</script>
