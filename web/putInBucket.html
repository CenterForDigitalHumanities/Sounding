<!DOCTYPE html>
<html>
	<head>
            <meta charset="utf-8">
            <link rel="stylesheet" href="../brokenBooks/css/brokenbooks.css">	
            <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>  
            <script src="http://localhost:8080/brokenBooks/js/bb.js"></script>  
            
            <title>Breviary Leaf Addition</title>
            <style>
            .rangeArrangementArea{
                display: inline-table;
            }
            </style>
	</head>
	<body>
            <div class="mainBlock intro">
                    <p>
                            Here you can create a leaf.  Once you are finished and the information is submitted it will be reviewed for accuracy.  If your data is accurate, your leaf will be placed with the other LLangantock Breviary leaves. 
                    </p>
                    <p>You will prepare this leaf as <span id="whoCreates">a contriubter</span></p>

                    <!-- TESTED. SUCCESSFUL.  
                    <div id="serverLogin">
                            <iframe id="serverLoginFrame" src="http://localhost/image_console.php" WIDTH=650 HEIGHT=400 >
                                            TEST TEST TEST
                            </iframe>
                    </div> -->

                    <input type="button" id="beginLeafCreation" value="Begin Preparing A Leaf" onclick="submitIntro();"/>
                    <!-- <input type="button" id="editLeaf" value="View Existing Leaf" onclick="existing();"/> -->
                    <!-- <input id="beAdmin" type="button" value="Be Project Admin" onclick="admin();"/> -->
                    <!-- <input id="beContributer" type="button" value="Be A Contributer" onclick="contributer();"/> -->
            </div>
            <div class="leafPopover"></div>
					
	</body>
</html>
<script>
var admin = false;
var contributer = true;

	$(function(){
		$(".leafPopover").load("../brokenBooks/leafPopover.html", function(){
                    $(".leaf").load("../brokenBooks/leafInformation.html", function(){
                        console.log("SET TABS");
                        $("#formTabs").tabs({
                            activate: function(event ,ui){
                            //console.log(event);
                            if(ui.newTab.index() === 4){ //check for the selection of the arrante tab to change the side bar
                                $(".sideBarInfo").hide();
                                $("#sideBarArrange").show();
                            }
                            else{
                                $(".sideBarInfo").show();
                                $("#sideBarArrange").hide();
                            }
                        }
                        });
                        $('.canvasImageFile').on("change", function(event){
                            var target = event.target;
                            var rv = $(this).attr("rv"); //This is so we know whether it was the recto or verso one.  
                            var files = !!this.files ? this.files : [];
                            var canvasURI = $(this).parent().attr("canvas"); //local
                            var canvasServerURI = $(this).parent().parent().find(".imgCatalogueInfo").attr("canvasServerID"); //live
                            if (!files.length || !window.FileReader) return 0; // no file selected, or no FileReader support

                            if (/^image/.test( files[0].type)){ // only image file
                                    var filename = files[0].name; //get the file name so we can pass it through the interfact for the user if we want.
                                var reader = new FileReader(); // instance of the FileReader
                                reader.readAsDataURL(files[0]); // read the local file
                                reader.onloadend = function(){ // set image data as background of div
                                    $("."+rv+"Img").attr("src", this.result).show("explode", "500ms");
                                    $("."+rv+"Canvas").find(".imgCatalogueInfo").show("explode", "500ms");
                                    $("textarea[rv='"+rv+"']").html(filename +" Uploaded!").attr("disabled", "disabled");
                                    var newAnnoURI = "http://www.example.org/iiif/LlangBrev/annos/" +annoID; 
                                    var newImageURI = "http://www.example.org/iiif/LlangBrev/images/" +imageID; 
                                    var annotationObject = {
                                                            "@id" : newAnnoURI,
                                                    "@type" : "oa:Annotation",
                                                    "motivation" : "sc:painting",
                                                    "label" : "Canvas Image",
                                                    "resource" : {
                                                            "@id" : newImageURI,
                                                            "@type" : "dctypes:Image",
                                                            "format" : "image/jpeg",
                                                            "height" : 2365,
                                                            "width" : 1579
                                                            },
                                                            "on" : canvasServerURI
                                                    };
                                                    //$("#catalogueInfoFor").val(canvasURI);
                                    //(annotationObject, canvasURI); // local
                                    addImage(annotationObject, canvasServerURI); // live\
                                    target.parentNode.childNodes[1].onclick=""; //Take the onclick away that fires upload image.
                                    target.parentNode.ondblclick=function(){ //Now it has to be double clicked to fire upload image. 
                                        target.click();
                                    };
                                };
                            }
                        });
                    });
                });
	});
		
</script>
